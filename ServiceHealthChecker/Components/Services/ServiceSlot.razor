@using ServiceHealthChecker.DB.Models

    <Frame>
        <StackLayout>
            <StackLayout Orientation="XF.StackOrientation.Horizontal">
                <Label Text=@service.Name />
                @if (info == null)
                {
                    <ActivityIndicator IsRunning="true" />
                }
                else
                {
                    <Label Text=@info.Status.ToString() />
                }
            </StackLayout>
            <StackLayout Orientation="XF.StackOrientation.Horizontal">
                <Button Text="Detail" OnClick=@(() => ServiceSelected.InvokeAsync(service)) IsEnabled=@(!isProbing) />
                <Button Text="Probe" OnClick=@probeService IsEnabled=@(!isProbing) />
                <ActivityIndicator IsVisible="isProbing" IsRunning="true" />
            </StackLayout>
        </StackLayout>
    </Frame>

@code
{
    //todo rename
    [Parameter]
    public Service service { get; set; }

    [Parameter]
    public EventCallback<Service> ServiceSelected { get; set; }

    private ProbingLog info = null;

    private bool isProbing;

    private async void probeService()
    {
        isProbing = true;

        //todo do some renaming for the love of god
        var result = await Testers.Tester.TestService(service);
        await App.LogsDb.SaveProbingLogAsync(result);
        isProbing = false;
        RefreshInfo();
    }

    protected override async Task OnInitializedAsync()
    {
        //little hack to make sure to break free from render loop
        await Task.Delay(1);
        await RefreshInfo();

    }

    private async Task RefreshInfo()
    {
        info = (await App.LogsDb.GetProbingLogsAsync(service.ID)).FirstOrDefault() ?? new ProbingLog();
        StateHasChanged();
    }
}